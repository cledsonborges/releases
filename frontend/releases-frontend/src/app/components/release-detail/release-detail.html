<div class="release-detail-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-button" (click)="goBack()">
          ← Voltar
        </button>
        <div class="release-info" *ngIf="releaseWithTestStatus">
          <h1>{{ releaseWithTestStatus.release_name }}</h1>
          <p class="release-subtitle">Status dos Testes por Squad</p>
        </div>
      </div>
      <div class="header-right">
        <button class="admin-button">Painel Admin</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Carregando status de testes...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="clearMessages()">Fechar</button>
  </div>

  <!-- Success Message -->
  <div *ngIf="success" class="success-message">
    <p>{{ success }}</p>
    <button (click)="clearMessages()">Fechar</button>
  </div>

  <!-- Release Details -->
  <div *ngIf="!loading && releaseWithTestStatus" class="release-details">
    <!-- Release Info Card -->
    <div class="release-info-card">
      <div class="info-item">
        <span class="label">Release:</span>
        <span class="value">{{ releaseWithTestStatus.release_name }}</span>
      </div>
      <div class="info-item">
        <span class="label">Versão Firebase:</span>
        <span class="value">{{ releaseWithTestStatus.versao_firebase || 'N/A' }}</span>
      </div>
      <div class="info-item">
        <span class="label">Liberado em:</span>
        <span class="value">{{ formatDate(releaseWithTestStatus.liberado_em) }}</span>
      </div>
    </div>

    <!-- Test Status Table -->
    <div class="table-container">
      <div class="table-header">
        <h3>Status dos Testes por Squad</h3>
        <button class="add-squad-btn" (click)="addNewSquad()" [disabled]="saving">
          + Adicionar Squad
        </button>
      </div>
      
      <table class="test-status-table">
        <thead>
          <tr>
            <th>Squad</th>
            <th>Responsável</th>
            <th>Status</th>
            <th>Observações</th>
            <th *ngIf="canEdit()">Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let testStatus of testStatuses" class="test-status-row">
            <!-- Squad -->
            <td class="squad-name">
              <strong>{{ testStatus.squad_name }}</strong>
            </td>
            
            <!-- Responsável -->
            <td class="responsavel-cell">
              <span *ngIf="!isEditing(testStatus.squad_name, 'responsavel')"
                    class="responsavel-text"
                    (click)="startEdit(testStatus.squad_name, 'responsavel', testStatus.responsavel)">
                {{ testStatus.responsavel || 'Clique para adicionar responsável' }}
              </span>
              <input 
                *ngIf="isEditing(testStatus.squad_name, 'responsavel')"
                type="text" 
                [(ngModel)]="editingValue"
                class="edit-input"
                (keyup.enter)="saveEdit()"
                (keyup.escape)="cancelEdit()"
                #editResponsavel>
            </td>
            
            <!-- Status -->
            <td class="status-cell">
              <span *ngIf="!isEditing(testStatus.squad_name, 'status')" 
                    class="status-badge"
                    [style.background-color]="getStatusColor(testStatus.status)"
                    (click)="canEditSquad(testStatus.squad_name) && startEdit(testStatus.squad_name, 'status', testStatus.status)">
                {{ getStatusLabel(testStatus.status) }}
              </span>
              <select 
                *ngIf="isEditing(testStatus.squad_name, 'status')"
                [(ngModel)]="editingValue"
                class="edit-select"
                (change)="saveEdit()"
                (keyup.escape)="cancelEdit()">
                <option *ngFor="let option of statusOptions" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </td>
            
            <!-- Observações -->
            <td class="observacoes-cell">
              <span *ngIf="!isEditing(testStatus.squad_name, 'observacoes')" 
                    class="observacoes-text"
                    (click)="canEditSquad(testStatus.squad_name) && startEdit(testStatus.squad_name, 'observacoes', testStatus.observacoes || '')">
                {{ testStatus.observacoes || 'Clique para adicionar observações' }}
              </span>
              <textarea 
                *ngIf="isEditing(testStatus.squad_name, 'observacoes')"
                [(ngModel)]="editingValue"
                class="edit-textarea"
                (keyup.enter)="saveEdit()"
                (keyup.escape)="cancelEdit()"
                rows="2"
                #editObservacoes></textarea>
            </td>
            
            <!-- Ações -->
            <td *ngIf="canEdit()" class="actions-cell">
              <div *ngIf="isEditing(testStatus.squad_name, editingField!)" class="edit-actions">
                <button class="save-btn" (click)="saveEdit()" [disabled]="saving">
                  {{ saving ? 'Salvando...' : 'Salvar' }}
                </button>
                <button class="cancel-btn" (click)="cancelEdit()" [disabled]="saving">Cancelar</button>
              </div>
              <div *ngIf="!isEditing(testStatus.squad_name, editingField!)" class="view-actions">
                <button class="edit-btn" 
                        (click)="startEdit(testStatus.squad_name, 'observacoes', testStatus.observacoes || '')"
                        [disabled]="!canEditSquad(testStatus.squad_name)">
                  Editar
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="testStatuses.length === 0" class="empty-state">
      <p>Nenhum status de teste encontrado para esta release.</p>
      <button class="add-squad-btn" (click)="addNewSquad()">Adicionar Primeira Squad</button>
    </div>
  </div>
</div>

