<div class="release-detail-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-button" (click)="goBack()">
          ← Voltar
        </button>
        <div class="release-info" *ngIf="release">
          <h1>{{ release.release_name }}</h1>
          <p class="release-subtitle">Squads que fizeram entregas nessa release</p>
        </div>
      </div>
      <div class="header-right">
        <button class="admin-button">Painel Admin</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Carregando detalhes da release...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="clearMessages()">Fechar</button>
  </div>

  <!-- Success Message -->
  <div *ngIf="success" class="success-message">
    <p>{{ success }}</p>
    <button (click)="clearMessages()">Fechar</button>
  </div>

  <!-- Release Details -->
  <div *ngIf="!loading && release" class="release-details">
    <!-- Release Info Card -->
    <div class="release-info-card">
      <div class="info-item">
        <span class="label">Release:</span>
        <span class="value">{{ release.release_name }}</span>
      </div>
      <div class="info-item">
        <span class="label">Versão Firebase:</span>
        <span class="value">{{ release.versao_firebase || 'N/A' }}</span>
      </div>
      <div class="info-item">
        <span class="label">Criado em:</span>
        <span class="value">{{ formatDate(release.created_at) }}</span>
      </div>
    </div>

    <!-- Squad Deliveries Table -->
    <div class="table-container">
      <table class="squad-deliveries-table">
        <thead>
          <tr>
            <th>Squad</th>
            <th>Módulo</th>
            <th>Detalhe da Entrega</th>
            <th>Responsável</th>
            <th>Status</th>
            <th *ngIf="canEdit()">Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let delivery of squadDeliveries" class="delivery-row">
            <!-- Squad -->
            <td class="squad-name">
              <strong>{{ delivery.squad_name }}</strong>
            </td>
            
            <!-- Módulo -->
            <td>
              <span *ngIf="!isEditing(delivery.squad_id, 'modulo')">
                {{ delivery.squad_name }}
              </span>
              <input 
                *ngIf="isEditing(delivery.squad_id, 'modulo')"
                type="text" 
                [(ngModel)]="editingValue"
                class="edit-input"
                (keyup.enter)="saveEdit()"
                (keyup.escape)="cancelEdit()"
                #editInput>
            </td>
            
            <!-- Detalhe da Entrega -->
            <td class="delivery-detail">
              <span *ngIf="!isEditing(delivery.squad_id, 'detalhe_entrega')" 
                    class="detail-text"
                    (click)="startEdit(delivery.squad_id, 'detalhe_entrega', delivery.detalhe_entrega)">
                {{ delivery.detalhe_entrega || 'Clique para adicionar detalhes' }}
              </span>
              <textarea 
                *ngIf="isEditing(delivery.squad_id, 'detalhe_entrega')"
                [(ngModel)]="editingValue"
                class="edit-textarea"
                (keyup.enter)="saveEdit()"
                (keyup.escape)="cancelEdit()"
                rows="3"
                #editTextarea></textarea>
            </td>
            
            <!-- Responsável -->
            <td>
              <span *ngIf="!isEditing(delivery.squad_id, 'responsavel')"
                    class="responsavel-text"
                    (click)="startEdit(delivery.squad_id, 'responsavel', delivery.responsavel)">
                {{ delivery.responsavel || 'Clique para adicionar responsável' }}
              </span>
              <input 
                *ngIf="isEditing(delivery.squad_id, 'responsavel')"
                type="text" 
                [(ngModel)]="editingValue"
                class="edit-input"
                (keyup.enter)="saveEdit()"
                (keyup.escape)="cancelEdit()"
                #editResponsavel>
            </td>
            
            <!-- Status -->
            <td class="status-cell">
              <span *ngIf="!isEditing(delivery.squad_id, 'status')" 
                    class="status-badge"
                    [style.background-color]="getStatusColor(delivery.status)"
                    (click)="startEdit(delivery.squad_id, 'status', delivery.status)">
                {{ getStatusLabel(delivery.status) }}
              </span>
              <select 
                *ngIf="isEditing(delivery.squad_id, 'status')"
                [(ngModel)]="editingValue"
                class="edit-select"
                (change)="saveEdit()"
                (keyup.escape)="cancelEdit()">
                <option *ngFor="let option of statusOptions" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </td>
            
            <!-- Ações -->
            <td *ngIf="canEdit()" class="actions-cell">
              <div *ngIf="isEditing(delivery.squad_id, editingField!)" class="edit-actions">
                <button class="save-btn" (click)="saveEdit()">Salvar</button>
                <button class="cancel-btn" (click)="cancelEdit()">Cancelar</button>
              </div>
              <div *ngIf="!isEditing(delivery.squad_id, editingField!)" class="view-actions">
                <button class="edit-btn" 
                        (click)="startEdit(delivery.squad_id, 'detalhe_entrega', delivery.detalhe_entrega)">
                  Editar
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="squadDeliveries.length === 0" class="empty-state">
      <p>Nenhuma squad encontrada para esta release.</p>
    </div>
  </div>
</div>

