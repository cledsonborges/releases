<div class="releases-table-container">
  <!-- Header -->
  <header class="table-header">
    <div class="container">
      <div class="header-content">
        <div class="header-left">
          <h1>Releases - {{ currentView === 'homolog' ? 'Homolog' : 'Alpha' }}</h1>
          <p>Visualiza√ß√£o e edi√ß√£o de status das releases</p>
        </div>
        <div class="header-right">
          <button class="btn btn-outline" (click)="goBack()">‚Üê Voltar</button>
          <button class="btn btn-primary" (click)="goToAdmin()" *ngIf="canEdit()">
            Painel Admin
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- View Switcher -->
    <div class="view-switcher">
      <button 
        class="view-btn" 
        [class.active]="currentView === 'homolog'"
        (click)="switchView('homolog')"
      >
        Homolog
      </button>
      <button 
        class="view-btn" 
        [class.active]="currentView === 'alpha'"
        (click)="switchView('alpha')"
      >
        Alpha
      </button>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="filters-grid">
        <div class="filter-group">
          <label for="statusFilter">Filtrar por Status:</label>
          <select 
            id="statusFilter" 
            [(ngModel)]="statusFilter" 
            (change)="onFilterChange()"
          >
            <option value="">Todos os status</option>
            <option value="em andamento">Em Andamento</option>
            <option value="conclu√≠do">Conclu√≠do</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label for="releaseFilter">Filtrar por Release:</label>
          <select 
            id="releaseFilter" 
            [(ngModel)]="releaseFilter" 
            (change)="onFilterChange()"
          >
            <option value="">Todas as releases</option>
            <option *ngFor="let release of getUniqueReleases()" [value]="release">
              {{ release }}
            </option>
          </select>
        </div>
        
        <div class="filter-actions">
          <button class="btn btn-secondary" (click)="refreshData()">
            üîÑ Atualizar
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Carregando releases...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3>Erro ao carregar dados</h3>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="refreshData()">
        Tentar novamente
      </button>
    </div>

    <!-- Releases Table -->
    <div *ngIf="!loading && !error" class="table-section">
      <div class="table-info">
        <p>
          Mostrando {{ filteredReleases.length }} de {{ releases.length }} releases
          <span *ngIf="statusFilter || releaseFilter"> (filtradas)</span>
        </p>
      </div>

      <div class="table-wrapper">
        <table class="releases-table">
          <thead>
            <tr>
              <th>Release</th>
              <th>Squad</th>
              <th>Vers√£o Homolog</th>
              <th>Vers√£o Firebase</th>
              <th>Respons√°vel</th>
              <th>Status</th>
              <th>Criado em</th>
              <th *ngIf="canEdit()">A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
           <tr *ngFor="let release of filteredReleases; trackBy: trackByReleaseId" (click)="selectRelease(release)" class="release-row"> 
                class="release-row" 
                (click)="selectRelease(release)"
                [class.selected]="selectedRelease?.release_id === release.release_id">
              <!-- Release Name -->
              <td class="release-name clickable">
                <strong>{{ release.release_name }}</strong>
                <small *ngIf="release.descricao">{{ release.descricao }}</small>
              </td>
              
              <!-- Squad -->
              <td>
                <span *ngIf="editingReleaseId !== release.release_id || editingField !== 'squad'">
                  {{ release.squad || '-' }}
                </span>
                <input 
                  *ngIf="editingReleaseId === release.release_id && editingField === 'squad'"
                  type="text"
                  [(ngModel)]="editingValue"
                  class="edit-input"
                  (keyup.enter)="saveEdit()"
                  (keyup.escape)="cancelEdit()"
                  #editInput
                />
              </td>
              
              <!-- Vers√£o Homolog -->
              <td>
                <span *ngIf="editingReleaseId !== release.release_id || editingField !== 'versao_homolog'">
                  {{ release.versao_homolog || '-' }}
                </span>
                <input 
                  *ngIf="editingReleaseId === release.release_id && editingField === 'versao_homolog'"
                  type="text"
                  [(ngModel)]="editingValue"
                  class="edit-input"
                  (keyup.enter)="saveEdit()"
                  (keyup.escape)="cancelEdit()"
                />
              </td>
              
              <!-- Vers√£o Firebase -->
              <td>
                <span *ngIf="editingReleaseId !== release.release_id || editingField !== 'versao_firebase'">
                  {{ release.versao_firebase || '-' }}
                </span>
                <input 
                  *ngIf="editingReleaseId === release.release_id && editingField === 'versao_firebase'"
                  type="text"
                  [(ngModel)]="editingValue"
                  class="edit-input"
                  (keyup.enter)="saveEdit()"
                  (keyup.escape)="cancelEdit()"
                />
              </td>
              
              <!-- Respons√°vel -->
              <td>
                <span *ngIf="editingReleaseId !== release.release_id || editingField !== 'responsavel'">
                  {{ release.responsavel || '-' }}
                </span>
                <input 
                  *ngIf="editingReleaseId === release.release_id && editingField === 'responsavel'"
                  type="text"
                  [(ngModel)]="editingValue"
                  class="edit-input"
                  (keyup.enter)="saveEdit()"
                  (keyup.escape)="cancelEdit()"
                />
              </td>
              
              <!-- Status -->
              <td>
                <span 
                  *ngIf="editingReleaseId !== release.release_id || editingField !== 'status'"
                  class="status-badge"
                  [class]="getStatusClass(release.status || '')"
                >
                  {{ release.status || 'N√£o definido' }}
                </span>
                <select 
                  *ngIf="editingReleaseId === release.release_id && editingField === 'status'"
                  [(ngModel)]="editingValue"
                  class="edit-select"
                  (change)="saveEdit()"
                >
                  <option *ngFor="let status of statusOptions" [value]="status">
                    {{ status }}
                  </option>
                </select>
              </td>
              
              <!-- Data de Cria√ß√£o -->
              <td class="date-cell">
                {{ formatDate(release.created_at || '') }}
              </td>
              
              <!-- A√ß√µes -->
              <td *ngIf="canEdit()" class="actions-cell">
                <div class="action-buttons">
                  <!-- Bot√µes de edi√ß√£o para cada campo -->
                  <button 
                    *ngIf="editingReleaseId !== release.release_id"
                    class="btn-icon edit-btn" 
                    (click)="startEdit(release.release_id!, 'status', release.status || '')"
                    title="Editar Status"
                  >
                    ‚úèÔ∏è
                  </button>
                  
                  <!-- Bot√µes de salvar/cancelar quando editando -->
                  <div *ngIf="editingReleaseId === release.release_id" class="edit-actions">
                    <button 
                      class="btn-icon save-btn" 
                      (click)="saveEdit()"
                      title="Salvar"
                    >
                      ‚úÖ
                    </button>
                    <button 
                      class="btn-icon cancel-btn" 
                      (click)="cancelEdit()"
                      title="Cancelar"
                    >
                      ‚ùå
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredReleases.length === 0" class="empty-state">
        <div class="empty-icon">üì¶</div>
        <h3>Nenhuma release encontrada</h3>
        <p *ngIf="statusFilter || releaseFilter">
          Tente ajustar os filtros ou 
          <button class="link-btn" (click)="statusFilter = ''; releaseFilter = ''; onFilterChange()">
            limpar filtros
          </button>
        </p>
        <p *ngIf="!statusFilter && !releaseFilter">
          N√£o h√° releases {{ currentView }} dispon√≠veis no momento.
        </p>
      </div>
    </div>

    <!-- Messages -->
    <div *ngIf="message" class="alert" [class]="messageType">
      {{ message }}
    </div>
  </div>
</div>

